{% extends 'plantilla.html' %}
{% block title %}Cursos{% endblock %}
<!-- ----------------------------------------------------->
{% block headerinf %}
<link rel="stylesheet" href="static/card.css">
{% endblock %}
{% block maincontent %}
<div class="title-main">
    <h2>Cursos</h2>
    <p>Ciclo lectivo 2024</p>
</div>
<div class="container-inputs" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <form action="" style="width: 100%; display: flex; justify-content: space-between;">
      <!-- Input de búsqueda -->
        <input id="search-input" 
        style="width: 280px; background-image: url('static/img/lupa.png'); background-repeat: no-repeat; background-position: 95% center; background-size: 20px;"  
          type="text" class="input-style" name="Curso" autocomplete="off" placeholder="Buscar:" required>
      
      <!-- Input de selección de año -->
      <div style="position: relative; width: 280px;">
        <div id="custom-select" onclick="toggleDropdown()" style="
            width: 100%; 
            font-size: 16px; 
            color: #333; 
            background-color: #fff; 
            border: 2px solid #d2d0d0; 
            border-radius: 8px; 
            padding: 12px 16px; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: #919eab4d 0 0 2px, #919eab1f 0 12px 24px -4px">
          <span id="selected-option">Selecciona el año</span>
          <span style="color: #000000;">▼</span> 
        </div>
      
        <div id="dropdown-options" style=" display: none; position: absolute; top: 100%; left: 0;
            width: 100%; background-color: #fff; border: 1px solid #ccc; border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);  max-height: 200px; overflow-y: auto; z-index: 1000;">

            <div onclick="selectOption('1er año')" style="padding: 10px 16px; cursor: pointer;">1er año</div>
            <div onclick="selectOption('2do año')" style="padding: 10px 16px; cursor: pointer;">2do año</div>
            <div onclick="selectOption('3er año')" style="padding: 10px 16px; cursor: pointer;">3er año</div>
            <div onclick="selectOption('4to año')" style="padding: 10px 16px; cursor: pointer;">4to año</div>
            <div onclick="selectOption('5to año')" style="padding: 10px 16px; cursor: pointer;">5to año</div>
            <div onclick="selectOption('6to año')" style="padding: 10px 16px; cursor: pointer;">6to año</div>
            <div onclick="selectOption('7mo año')" style="padding: 10px 16px; cursor: pointer;">7mo año</div>
            <div onclick="selectOption('Todos')" style="padding: 10px 16px; cursor: pointer;">todos</div>
            </div>
        </div>
      
        <script>
            function toggleDropdown() {
            const dropdown = document.getElementById("dropdown-options");
            dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
            }
        
            function selectOption(optionText) {
            document.getElementById("selected-option").innerText = optionText;
            document.getElementById("dropdown-options").style.display = "none";
            }
        
            // Cierra el dropdown si haces clic fuera de él
            document.addEventListener("click", function(event) {
            const customSelect = document.getElementById("custom-select");
            const dropdownOptions = document.getElementById("dropdown-options");
            if (!customSelect.contains(event.target)) {
                dropdownOptions.style.display = "none";
            }
            });
        </script>
    </form>
</div>

<div class="contenedor-tarjetas" id="cursoContainer"></div>

<script>
    //Convierte los cursos en un arreglo o lista de strings desde JSON
    const cursos = JSON.parse('{{ cursos | tojson }}');

    const container = document.getElementById('cursoContainer');
    const searchInput = document.getElementById('search-input');

    async function loadTemplate() {
        const response = await fetch('/get-carta-template');
        return await response.text();
    }

    async function generateCards(year) {
        container.innerHTML = ''; 
        const template = await loadTemplate();
        if (year === 'todos') {
            cursos.forEach(course => {
                const card = createCard(template, course);
                container.innerHTML += card;
            });
        } else {
            cursos.filter(course => course.year === year).forEach(course => {
                const card = createCard(template, course);
                container.innerHTML += card;
            });
        }
    }

    generateCards('todos');

    function createCard(template, course) {
        return template.replace('${course}', course);
    }

    function filterCards() {
        const searchTerm = searchInput.value.toLowerCase();
        const cards = document.querySelectorAll('.card-container');

        cards.forEach(card => {
            const title = card.querySelector('.titulo-tarjeta').innerText.toLowerCase();
            if (title.includes(searchTerm)) {
                card.style.display = ''; 
            } else {
                card.style.display = 'none'; 
            }
        });
    }

    function selectOption(option) {
        const year = option === '1er año' ? '1ro' :
                     option === '2do año' ? '2do' :
                     option === '3er año' ? '3ro' :
                     option === '4to año' ? '4to' :
                     option === '5to año' ? '5to' :
                     option === '6to año' ? '6to' :
                     option === '7mo año' ? '7mo' :
                     option === 'Todos' ? 'todos' : null;

        document.getElementById('selected-option').innerText = option;
        generateCards(year);
        filterCards();
    }

    searchInput.addEventListener('input', filterCards);

    const dropdownCursos = document.getElementById('dropdown');
    const allOption = document.createElement('option');
    allOption.text = 'Todos';
    allOption.value = 'Todos';
    dropdownCursos.add(allOption);

</script>

{% endblock %}